<dx:ThemedWindow 
 x:Class="DeskLink.MainWindow"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
 xmlns:dxa="http://schemas.devexpress.com/winfx/2008/xaml/accordion"
 xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
 xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
 xmlns:conv="clr-namespace:DeskLink.Core.Converters"
 xmlns:models="clr-namespace:DeskLink.Core.Models"
 Title="DeskLink" Height="850" Width="1600" WindowStartupLocation="CenterScreen">
 <dx:ThemedWindow.Resources>
 <conv:NullToVisibilityConverter x:Key="NullToVis"/>
 <conv:InverseNullToVisibilityConverter x:Key="InverseNullToVis"/>
 <conv:HealthToBrushConverter x:Key="HealthToBrush"/>
 <conv:ColorHexToBrushConverter x:Key="ColorHexToBrush"/>
 <conv:InverseBoolConverter x:Key="InverseBoolConverter"/>
 <BooleanToVisibilityConverter x:Key="BoolToVis"/>
 
 <ObjectDataProvider x:Key="LinkTypeValues" MethodName="GetValues" ObjectType="{x:Type models:LinkType}">
 <ObjectDataProvider.MethodParameters>
 <x:Type TypeName="models:LinkType"/>
 </ObjectDataProvider.MethodParameters>
 </ObjectDataProvider>
 
 <!-- Modern Button Style -->
 <Style x:Key="ModernButtonStyle" TargetType="ButtonBase">
 <Setter Property="Background" Value="#3A3A3A"/>
 <Setter Property="Foreground" Value="White"/>
 <Setter Property="BorderBrush" Value="#555"/>
 <Setter Property="BorderThickness" Value="1"/>
 <Setter Property="Padding" Value="16,8"/>
 <Setter Property="FontSize" Value="13"/>
 <Setter Property="Cursor" Value="Hand"/>
 <Setter Property="Template">
 <Setter.Value>
 <ControlTemplate TargetType="ButtonBase">
 <Border Background="{TemplateBinding Background}" 
 BorderBrush="{TemplateBinding BorderBrush}"
 BorderThickness="{TemplateBinding BorderThickness}"
 CornerRadius="4">
 <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
 </Border>
 </ControlTemplate>
 </Setter.Value>
 </Setter>
 <Style.Triggers>
 <Trigger Property="IsMouseOver" Value="True">
 <Setter Property="Background" Value="#4A4A4A"/>
 </Trigger>
 <Trigger Property="IsPressed" Value="True">
 <Setter Property="Background" Value="#2A2A2A"/>
 </Trigger>
 </Style.Triggers>
 </Style>
 </dx:ThemedWindow.Resources>
 
 <Grid Background="#1E1E1E">
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 <RowDefinition Height="Auto"/>
 </Grid.RowDefinitions>
 
 <!-- Top Toolbar -->
 <Border Grid.Row="0" Background="#252525" BorderBrush="#3A3A3A" BorderThickness="0,0,0,1" Padding="16,12">
 <Grid>
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="Auto"/>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="Auto"/>
 </Grid.ColumnDefinitions>
 
 <!-- Left: Search -->
 <StackPanel Orientation="Horizontal" Grid.Column="0">
 <TextBox x:Name="SearchBox" Width="350" Height="36" VerticalContentAlignment="Center"
 Text="{Binding Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
 Background="#2A2A2A" Foreground="White"
 BorderBrush="#555" BorderThickness="1" Padding="12,0"/>
 
 <ComboBox Width="160" Height="36" Margin="12,0,0,0" SelectedValue="{Binding SortBy, Mode=TwoWay}" 
 SelectedValuePath="Content" Background="#2A2A2A" Foreground="White" BorderBrush="#555">
 <ComboBoxItem Content="Name"/>
 <ComboBoxItem Content="Recent"/>
 <ComboBoxItem Content="Frequency"/>
 </ComboBox>
 </StackPanel>
 
 <!-- Right: Actions -->
 <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Right">
 <ToggleButton Content="⊞ Grid" Width="100" Height="36" Margin="0,0,8,0" 
 IsChecked="{Binding IsTileView, Mode=TwoWay, Converter={StaticResource InverseBoolConverter}}"
 Style="{StaticResource ModernButtonStyle}"/>
 <ToggleButton Content="▦ Tiles" Width="100" Height="36" Margin="0,0,16,0"
 IsChecked="{Binding IsTileView, Mode=TwoWay}"
 Style="{StaticResource ModernButtonStyle}"/>
 <Button Content="➕ New Link" Width="110" Height="36" Margin="0,0,8,0"
 Click="OnNewLinkClick" Style="{StaticResource ModernButtonStyle}"/>
 <Button Content="💚 Health Check" Width="130" Height="36" Margin="0,0,8,0" 
 Click="OnHealthAllClick" Style="{StaticResource ModernButtonStyle}"/>
 <Button Content="📥 Import" Width="100" Height="36" Margin="0,0,8,0" 
 Click="OnImportClick" Style="{StaticResource ModernButtonStyle}"/>
 <Button Content="📤 Export" Width="100" Height="36" 
 Click="OnExportClick" Style="{StaticResource ModernButtonStyle}"/>
 </StackPanel>
 </Grid>
 </Border>
 
 <!-- Main Content -->
 <Grid Grid.Row="1">
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="260"/>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="340"/>
 </Grid.ColumnDefinitions>
 
 <!-- Left Sidebar: Categories -->
 <Border Grid.Column="0" Background="#252525" BorderBrush="#3A3A3A" BorderThickness="0,0,1,0" Padding="12">
 <DockPanel>
 <TextBlock Text="📂 Categories" DockPanel.Dock="Top" FontSize="15" FontWeight="Bold" 
 Foreground="White" Margin="0,0,0,16"/>
 
 <ListBox ItemsSource="{Binding Categories}" SelectedItem="{Binding CategoryFilter, Mode=TwoWay}"
 Background="Transparent" BorderThickness="0" Foreground="White">
 <ListBox.ItemContainerStyle>
 <Style TargetType="ListBoxItem">
 <Setter Property="Background" Value="Transparent"/>
 <Setter Property="Foreground" Value="White"/>
 <Setter Property="Padding" Value="12,8"/>
 <Setter Property="Margin" Value="0,2"/>
 <Setter Property="Cursor" Value="Hand"/>
 <Setter Property="Template">
 <Setter.Value>
 <ControlTemplate TargetType="ListBoxItem">
 <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
 <ContentPresenter/>
 </Border>
 </ControlTemplate>
 </Setter.Value>
 </Setter>
 <Style.Triggers>
 <Trigger Property="IsSelected" Value="True">
 <Setter Property="Background" Value="#4A4A4A"/>
 <Setter Property="FontWeight" Value="SemiBold"/>
 </Trigger>
 <Trigger Property="IsMouseOver" Value="True">
 <Setter Property="Background" Value="#3A3A3A"/>
 </Trigger>
 </Style.Triggers>
 </Style>
 </ListBox.ItemContainerStyle>
 </ListBox>
 </DockPanel>
 </Border>
 
 <!-- Center: Tiles/Grid -->
 <Grid Grid.Column="1" Background="#1E1E1E">
 <!-- Tile View -->
 <ScrollViewer VerticalScrollBarVisibility="Auto" Visibility="{Binding IsTileView, Converter={StaticResource BoolToVis}}"
 Padding="16" AllowDrop="True" Drop="OnItemsDrop">
 <ItemsControl ItemsSource="{Binding Items}">
 <ItemsControl.ItemsPanel>
 <ItemsPanelTemplate>
 <WrapPanel Orientation="Horizontal"/>
 </ItemsPanelTemplate>
 </ItemsControl.ItemsPanel>
 <ItemsControl.ItemTemplate>
 <DataTemplate>
 <Border Width="280" Height="140" Margin="8" CornerRadius="8" 
 Background="{Binding ColorHex, Converter={StaticResource ColorHexToBrush}}" 
 BorderBrush="#555" BorderThickness="1" MouseLeftButtonUp="OnTileClick" Cursor="Hand">
 <Border.Effect>
 <DropShadowEffect BlurRadius="12" ShadowDepth="4" Opacity="0.3" Color="#000"/>
 </Border.Effect>
 <Border.ContextMenu>
 <ContextMenu Background="#2A2A2A" Foreground="White">
 <MenuItem Header="▶ Run" Click="OnTileRunClick"/>
 <MenuItem Header="✏ Edit" Click="OnTileEditClick"/>
 <MenuItem Header="⭐ Toggle Favorite" Click="OnTileFavoriteClick"/>
 <MenuItem Header="💚 Health Check" Click="OnTileHealthCheckClick"/>
 <Separator/>
 <MenuItem Header="🗑 Delete" Click="OnTileDeleteClick"/>
 </ContextMenu>
 </Border.ContextMenu>
 <Grid Margin="16">
 <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
 <RowDefinition Height="*"/>
 <RowDefinition Height="Auto"/>
 </Grid.RowDefinitions>
 
 <!-- Header with Status -->
 <Grid Grid.Row="0">
 <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="16" Foreground="White" TextTrimming="CharacterEllipsis"/>
 <Ellipse Width="12" Height="12" Fill="{Binding Health, Converter={StaticResource HealthToBrush}}" 
 HorizontalAlignment="Right" VerticalAlignment="Top"/>
 </Grid>
 
 <!-- Target -->
 <TextBlock Grid.Row="1" Text="{Binding Target}" FontSize="11" Foreground="#CCC" 
 TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Margin="0,8"/>
 
 <!-- Tags -->
 <StackPanel Grid.Row="2" Orientation="Horizontal">
 <Border Background="#00000040" CornerRadius="3" Padding="6,3" Margin="0,0,4,0">
 <TextBlock Text="{Binding Category}" FontSize="10" Foreground="#EEE"/>
 </Border>
 <Border Background="#00000040" CornerRadius="3" Padding="6,3">
 <TextBlock Text="{Binding Type}" FontSize="10" Foreground="#DDD"/>
 </Border>
 </StackPanel>
 </Grid>
 </Border>
 </DataTemplate>
 </ItemsControl.ItemTemplate>
 </ItemsControl>
 </ScrollViewer>
 
 <!-- Grid View -->
 <dxg:GridControl ItemsSource="{Binding Items}" SelectedItem="{Binding Selected, Mode=TwoWay}">
 <dxg:GridControl.Style>
 <Style TargetType="dxg:GridControl">
 <Setter Property="Visibility" Value="Visible"/>
 <Style.Triggers>
 <DataTrigger Binding="{Binding IsTileView}" Value="True">
 <Setter Property="Visibility" Value="Collapsed"/>
 </DataTrigger>
 </Style.Triggers>
 </Style>
 </dxg:GridControl.Style>
 <dxg:GridControl.Columns>
 <dxg:GridColumn FieldName="Name" Header="Name" Width="250"/>
 <dxg:GridColumn FieldName="Type" Header="Type" Width="100"/>
 <dxg:GridColumn FieldName="Target" Header="Target" Width="*"/>
 <dxg:GridColumn FieldName="Category" Header="Category" Width="140"/>
 <dxg:GridColumn FieldName="Health" Header="Status" Width="100"/>
 </dxg:GridControl.Columns>
 <dxg:GridControl.View>
 <dxg:TableView AutoWidth="False" ShowGroupPanel="False" RowDoubleClick="OnRowDoubleClick"/>
 </dxg:GridControl.View>
 </dxg:GridControl>
 </Grid>
 
 <!-- Right Sidebar: Properties / Edit -->
 <Border Grid.Column="2" Background="#252525" BorderBrush="#3A3A3A" BorderThickness="1,0,0,0" Padding="16">
 <ScrollViewer VerticalScrollBarVisibility="Auto">
 <StackPanel>
 <TextBlock Text="📋 Properties" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,16"/>
 
 <!-- Selected 값 디버그 표시 -->
 <TextBlock Text="{Binding Selected.Name, FallbackValue='No Selection', TargetNullValue='Null Value'}" 
 FontSize="10" Foreground="Yellow" Margin="0,0,0,8"/>
 
 <StackPanel Visibility="{Binding Selected, Converter={StaticResource NullToVis}}">
 <!-- Name -->
 <TextBlock Text="Name" FontSize="11" Foreground="#999" Margin="0,8,0,4"/>
 <dxe:TextEdit Text="{Binding Selected.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
 Background="#2A2A2A" Foreground="White" BorderBrush="#555"/>
 
 <!-- Type -->
 <TextBlock Text="Type" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <ComboBox SelectedItem="{Binding Selected.Type, Mode=TwoWay}" 
 ItemsSource="{Binding Source={StaticResource LinkTypeValues}}"
 Background="#2A2A2A" Foreground="White" BorderBrush="#555" Height="30"/>
 
 <!-- Target -->
 <TextBlock Text="Target" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <dxe:TextEdit Text="{Binding Selected.Target, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
 Background="#2A2A2A" Foreground="White" BorderBrush="#555"/>
 
 <!-- Category -->
 <TextBlock Text="Category" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <dxe:TextEdit Text="{Binding Selected.Category, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
 Background="#2A2A2A" Foreground="White" BorderBrush="#555"/>
 
 <!-- Color -->
 <TextBlock Text="Color" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <Grid>
 <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="Auto"/>
 </Grid.ColumnDefinitions>
 
 <!-- Color Preview -->
 <Border Grid.Column="0" Height="30" CornerRadius="4" Margin="0,0,8,0"
 Background="{Binding Selected.ColorHex, Converter={StaticResource ColorHexToBrush}}"
 BorderBrush="#555" BorderThickness="1">
 <TextBlock Text="{Binding Selected.ColorHex}" FontSize="11" Foreground="White" 
 HorizontalAlignment="Center" VerticalAlignment="Center"/>
 </Border>
 
 <!-- Color Picker Button -->
 <Button Grid.Column="1" Content="🎨 Pick" Width="70" Height="30" 
 Click="OnColorPickClick" Style="{StaticResource ModernButtonStyle}" Padding="8,4"/>
 </Grid>
 
 <!-- Tags -->
 <TextBlock Text="Tags" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <dxe:TextEdit Text="{Binding Selected.Tags, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
 Background="#2A2A2A" Foreground="White" BorderBrush="#555"/>
 
 <!-- Health -->
 <TextBlock Text="Health Status" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <StackPanel Orientation="Horizontal">
 <Ellipse Width="10" Height="10" Fill="{Binding Selected.Health, Converter={StaticResource HealthToBrush}}" 
 VerticalAlignment="Center" Margin="0,0,8,0"/>
 <TextBlock Text="{Binding Selected.Health}" FontSize="13" Foreground="#CCC"/>
 </StackPanel>
 
 <!-- Last Checked -->
 <TextBlock Text="Last Checked" FontSize="11" Foreground="#999" Margin="0,12,0,4"/>
 <TextBlock Text="{Binding Selected.LastCheckedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" 
 FontSize="13" Foreground="#CCC"/>
 
 <!-- Actions -->
 <StackPanel Margin="0,20,0,0">
 <Button Content="💾 Save Changes" Click="OnSaveClick" Style="{StaticResource ModernButtonStyle}" Margin="0,0,0,8"/>
 <Button Content="🗑 Delete" Click="OnDeleteClick" Style="{StaticResource ModernButtonStyle}"/>
 </StackPanel>
 </StackPanel>
 
 <TextBlock Text="Select an item to view details" FontSize="13" Foreground="#666" 
 Visibility="{Binding Selected, Converter={StaticResource InverseNullToVis}}"
 VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,40"/>
 </StackPanel>
 </ScrollViewer>
 </Border>
 </Grid>
 
 <!-- Status Bar -->
 <Border Grid.Row="2" Background="#252525" BorderBrush="#3A3A3A" BorderThickness="0,1,0,0" Padding="16,8">
 <Grid>
 <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
 <TextBlock Text="📊" FontSize="14" Margin="0,0,8,0" Foreground="White"/>
 <TextBlock Text="{Binding StatusText}" FontSize="13" Foreground="White" FontWeight="SemiBold"/>
 </StackPanel>
 
 <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" 
 Visibility="{Binding IsHealthChecking, Converter={StaticResource BoolToVis}}">
 <TextBlock Text="{Binding HealthProgress}" FontSize="13" Foreground="#CCC" Margin="0,0,4,0"/>
 <TextBlock Text="/" FontSize="13" Foreground="#666" Margin="0,0,4,0"/>
 <TextBlock Text="{Binding HealthTotal}" FontSize="13" Foreground="#CCC" Margin="0,0,12,0"/>
 <ProgressBar Minimum="0" Maximum="{Binding HealthTotal}" Value="{Binding HealthProgress}" 
 Width="200" Height="20" Background="#3A3A3A" Foreground="#4CAF50" BorderThickness="0"/>
 </StackPanel>
 </Grid>
 </Border>
 </Grid>
</dx:ThemedWindow>
